name: Daily Data Update

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 8:00 —É—Ç—Ä–∞ (UTC)
    - cron: '0 8 * * *'
  # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (—á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-db:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'

      # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Go –º–æ–¥—É–ª—å, –µ—Å–ª–∏ –µ–≥–æ –≤–¥—Ä—É–≥ –Ω–µ—Ç (—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞)
      - name: Init Go module
        run: |
          if [ ! -f go.mod ]; then
            go mod init open-switcher
            go get github.com/lib/pq
          fi

      - name: Run Data Collector
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
        run: go run main.go

      - name: Commit and Push changes
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ db.json
          if [[ `git status --porcelain db.json` ]]; then
            git add db.json
            git commit -m "ü§ñ Auto-update: Fresh data from GitHub"
            git push
            echo "‚úÖ Changes pushed to repository."
          else
            echo "üí§ No changes in data."
          fi